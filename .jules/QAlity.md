## 2024-05-24 - Dynamic Import Mocking **Learning:** When mocking modules that are dynamically imported (e.g., `import('html-to-image')`), `jest.mock()` must be at the top level of the file to ensure the mock is registered before the dynamic import is executed or the module is resolved. If `jest.mock()` is inside `describe()`, the real module might be loaded. **Action:** Always place `jest.mock()` calls at the top level of the test file, outside of `describe()` blocks, especially for modules used via dynamic imports.

## 2024-05-24 - Spy Restoration **Learning:** `jest.clearAllMocks()` only clears usage data (calls, instances) but does not restore the original implementation of spies created with `jest.spyOn(...).mockReturnValue(...)`. This can cause side effects across tests if a global object (like `document.createElement`) is spied on. **Action:** Use `jest.restoreAllMocks()` in `beforeEach` (or `afterEach`) to ensure all spies are reset to their original implementation.
